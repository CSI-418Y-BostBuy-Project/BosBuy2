{"ast":null,"code":"var _jsxFileName = \"/Users/nicholasfarinacci/Desktop/ICSI418Y/BosBuy/client/src/Checkout.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { useNavigate } from 'react-router-dom';\nimport { useCart } from './CartContext'; // Ensure this path is correct\nimport { useAuth } from './UserContext'; // If user context holds authentication and user info\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Checkout = () => {\n  _s();\n  var _authState$user3, _authState$user4;\n  const navigate = useNavigate();\n  const {\n    cartItems,\n    clearCart\n  } = useCart();\n  const {\n    authState\n  } = useAuth();\n  const [cards, setCards] = useState([]);\n  const [selectedCard, setSelectedCard] = useState('');\n  useEffect(() => {\n    var _authState$user;\n    axios.get(`http://localhost:9000/getCards/${(_authState$user = authState.user) === null || _authState$user === void 0 ? void 0 : _authState$user._id}`).then(response => {\n      var _authState$user2, _response$data$cards$;\n      setCards(response.data.cards);\n      setSelectedCard(((_authState$user2 = authState.user) === null || _authState$user2 === void 0 ? void 0 : _authState$user2.defaultCard) || ((_response$data$cards$ = response.data.cards[0]) === null || _response$data$cards$ === void 0 ? void 0 : _response$data$cards$._id));\n    }).catch(error => console.error('Failed to fetch cards:', error));\n  }, [(_authState$user3 = authState.user) === null || _authState$user3 === void 0 ? void 0 : _authState$user3._id, (_authState$user4 = authState.user) === null || _authState$user4 === void 0 ? void 0 : _authState$user4.defaultCard]);\n  const handlePayment = async () => {\n    if (!cartItems.length) {\n      alert('Your cart is empty.');\n      return;\n    }\n    try {\n      const response = await axios.post('http://localhost:9000/saveReceipt', {\n        products: cartItems.map(item => ({\n          productId: item._id,\n          quantity: item.quantity,\n          unitPrice: item.price,\n          totalPrice: item.quantity * item.price\n        })),\n        totalAmount: totalSum,\n        cardUsed: selectedCard,\n        user: authState.user._id,\n        receiptNumber: generateReceiptNumber() // You need to implement this function\n      });\n      if (response.data.success) {\n        alert('Payment successful!');\n        clearCart();\n        navigate('/');\n      } else {\n        alert('Failed to save receipt.');\n      }\n    } catch (error) {\n      var _error$response, _error$response$data;\n      console.error('Error saving receipt:', error);\n      alert('Failed to save receipt: ' + ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || error.message);\n    }\n  };\n  const generateReceiptNumber = () => {\n    const timestamp = Date.now().toString(36); // Convert timestamp to base36 string\n    const userIdPart = authState.user._id.slice(-4); // Take last 4 characters of user ID\n    return `RCPT-${userIdPart}-${timestamp}`;\n  };\n  const totalSum = cartItems.reduce((acc, item) => acc + item.price * item.quantity, 0);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Checkout\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n      children: cartItems.map(item => /*#__PURE__*/_jsxDEV(\"li\", {\n        children: [item.name, \" - \", item.quantity, \" x $\", item.price.toFixed(2), \" = $\", (item.quantity * item.price).toFixed(2)]\n      }, item._id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 21\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n      children: [\"Total: $\", totalSum.toFixed(2)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n      value: selectedCard,\n      onChange: e => setSelectedCard(e.target.value),\n      children: cards.map(card => /*#__PURE__*/_jsxDEV(\"option\", {\n        value: card._id,\n        children: [card.cardName, \" -- Expires on \", card.expirationDate]\n      }, card._id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 21\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handlePayment,\n      children: \"Pay\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 65,\n    columnNumber: 9\n  }, this);\n};\n_s(Checkout, \"ENFVu3+OK6HiroZv4tSELX5JFQ4=\", false, function () {\n  return [useNavigate, useCart, useAuth];\n});\n_c = Checkout;\nexport default Checkout;\nvar _c;\n$RefreshReg$(_c, \"Checkout\");","map":{"version":3,"names":["React","useState","useEffect","axios","useNavigate","useCart","useAuth","jsxDEV","_jsxDEV","Checkout","_s","_authState$user3","_authState$user4","navigate","cartItems","clearCart","authState","cards","setCards","selectedCard","setSelectedCard","_authState$user","get","user","_id","then","response","_authState$user2","_response$data$cards$","data","defaultCard","catch","error","console","handlePayment","length","alert","post","products","map","item","productId","quantity","unitPrice","price","totalPrice","totalAmount","totalSum","cardUsed","receiptNumber","generateReceiptNumber","success","_error$response","_error$response$data","message","timestamp","Date","now","toString","userIdPart","slice","reduce","acc","children","fileName","_jsxFileName","lineNumber","columnNumber","name","toFixed","value","onChange","e","target","card","cardName","expirationDate","onClick","_c","$RefreshReg$"],"sources":["/Users/nicholasfarinacci/Desktop/ICSI418Y/BosBuy/client/src/Checkout.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { useNavigate } from 'react-router-dom';\nimport { useCart } from './CartContext'; // Ensure this path is correct\nimport { useAuth } from './UserContext'; // If user context holds authentication and user info\n\nconst Checkout = () => {\n    const navigate = useNavigate();\n    const { cartItems, clearCart } = useCart();\n    const { authState } = useAuth();\n    const [cards, setCards] = useState([]);\n    const [selectedCard, setSelectedCard] = useState('');\n\n    useEffect(() => {\n        axios.get(`http://localhost:9000/getCards/${authState.user?._id}`)\n            .then(response => {\n                setCards(response.data.cards);\n                setSelectedCard(authState.user?.defaultCard || (response.data.cards[0]?._id));\n            })\n            .catch(error => console.error('Failed to fetch cards:', error));\n    }, [authState.user?._id, authState.user?.defaultCard]);\n\n    const handlePayment = async () => {\n        if (!cartItems.length) {\n            alert('Your cart is empty.');\n            return;\n        }\n    \n        try {\n            const response = await axios.post('http://localhost:9000/saveReceipt', {\n                products: cartItems.map(item => ({\n                    productId: item._id,\n                    quantity: item.quantity,\n                    unitPrice: item.price,\n                    totalPrice: item.quantity * item.price\n                })),\n                totalAmount: totalSum,\n                cardUsed: selectedCard,\n                user: authState.user._id,\n                receiptNumber: generateReceiptNumber() // You need to implement this function\n            });\n            \n            if (response.data.success) {\n                alert('Payment successful!');\n                clearCart();\n                navigate('/');\n            } else {\n                alert('Failed to save receipt.');\n            }\n        } catch (error) {\n            console.error('Error saving receipt:', error);\n            alert('Failed to save receipt: ' + error.response?.data?.message || error.message);\n        }\n    };\n\n    const generateReceiptNumber = () => {\n        const timestamp = Date.now().toString(36); // Convert timestamp to base36 string\n        const userIdPart = authState.user._id.slice(-4); // Take last 4 characters of user ID\n        return `RCPT-${userIdPart}-${timestamp}`;\n    };\n\n    const totalSum = cartItems.reduce((acc, item) => acc + (item.price * item.quantity), 0);\n\n    return (\n        <div>\n            <h1>Checkout</h1>\n            <ul>\n                {cartItems.map(item => (\n                    <li key={item._id}>\n                        {item.name} - {item.quantity} x ${item.price.toFixed(2)} = ${(item.quantity * item.price).toFixed(2)}\n                    </li>\n                ))}\n            </ul>\n            <h2>Total: ${totalSum.toFixed(2)}</h2>\n            <select value={selectedCard} onChange={e => setSelectedCard(e.target.value)}>\n                {cards.map(card => (\n                    <option key={card._id} value={card._id}>{card.cardName} -- Expires on {card.expirationDate}</option>\n                ))}\n            </select>\n            <button onClick={handlePayment}>Pay</button>\n        </div>\n    );\n};\n\nexport default Checkout;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}